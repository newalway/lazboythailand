{% extends "ProjectBundle:Lazboy:layout_email.html.twig" %}

{% block content %}
    <!--[if gte mso 9]>
		<v:background xmlns:v="urn:schemas-microsoft-com:vml" fill="t">
			<v:fill type="tile" color="#eeeeee"></v:fill>
		</v:background>
	<![endif]-->
    <table class="es-wrapper" width="100%" cellspacing="0" cellpadding="0" border="0">
        <tbody>
            <tr>
                <td colspan="3" class="esd-block-image es-p25t es-p25b es-p35r es-p35l" align="center">
                    <a target="_blank" href="{{app.request.getSchemeAndHttpHost()}}"> <img style="margin-top:35px;"src="https://tlr.stripocdn.email/content/guids/CABINET_75694a6fc3c4633b3ee8e3c750851c02/images/67611522142640957.png" alt="" style="display: block;" width="120"> </a>
                </td>
            </tr>
            <tr>
                <td colspan="3" class="esd-block-text es-p10b" align="center">
                    <h2>Thank You For Your Order!</h2>
                </td>
            </tr>
            <tr>
                <td colspan="3" class="esd-block-text es-p15t es-p20b" align="left">
                    <h4 align="center">Order Number #{{ order.ordernumber }}</h4>
                </td>
            </tr>
            <tr style="background-color:#D3D3D3;">
                <td colspan="2" align="center">
                    <h4>{% trans %}order.items{% endtrans %} ({% trans %}order.qty{% endtrans %})</h4>
                </td>
                <td >
                    <h4>{% trans %}order.price{% endtrans %}</h4>
                </td>
            </tr>
            {% for product in arr_cart_data.products %}
                {% set customer_order_item_options = product.product_option %}
                {% set product_category = product.product_category %}

                <tr>
                    <td width="16%" style="padding: 5px 10px 5px 0" >
                        <p>
                            {#{{ app.request.uriForPath('/../lazboy/images/logo.png')}}#}
                            {% if product.image_small %}
                                <img src="{{client_protocal}}:{{product.image_small}}" alt="" style="" width="50px;"/>
                            {% endif %}
                        </p>
                    </td>
                    <td  align="left">
                        <p>
                            {{product.title}} ({{product.quantity}})

                            {% if product.is_pre_order %}
                                <span class="badge badge-primary"><small>{% trans %}order.pre_order{% endtrans %}</small></span>
                            {% elseif product.is_pre_order == 0 and product.inventory_policy_status and product.inventory_quantity>0 %}
                                <span class="badge badge-primary"><small>{% trans %}order.instock{% endtrans %}</small></span>
                            {% endif %}

                            {% if product.variant_option|length > 0 %}
                                <br/>
                                <small>
                                    {% if product_category.title is defined %}
                                        <span>{{product_category.title}}&nbsp;</span>
                                    {% endif %}
                                    {{ product.variant_option|join(' · ') }}
                                </small>
                            {% endif %}

                            {% if product.sku %}
                                <br/>
                                <small>SKU:&nbsp;{{product.sku}}</small>
                            {% endif %}
                        </p>

                        {% if customer_order_item_options|length > 0 %}
                            <div style="font-size: 13px;">
                                <span>Options {% if product.sum_options_price>0 %} ({% trans %}total{% endtrans %} ฿{{product.sum_options_price|number_format(0, '.', ',')}}) {% endif %}</span>

                                <ul style="padding-left:18px;">
                                    {% for customer_order_item_option in customer_order_item_options %}
                                        <li style="font-size:12px; list-style-type:disc; display:list-item">
                                            <span>&nbsp;{{customer_order_item_option.option_category_title}}:</span>
                                            <span>{{customer_order_item_option.option_title}}</span>
                                            {% if customer_order_item_option.option_price>0 %}
                                                <span>(+฿{{customer_order_item_option.option_price}})</span>
                                            {% endif %}
                                        </li>
                                    {% endfor %}
                                </ul>
                            </div>
                        {% endif %}

                    </td>
                    <td width="20%" style="padding: 5px 0"  align="left">
                        <p>
                            ฿{{product.amount|number_format(0, '.', ',')}}
                            {% if product.compare_at_price>0 and product.compare_at_price > product.sum_options_price %}
                                <del>฿{{ product.compare_at_price|number_format(0, '.', ',') }}</del>
                            {% endif %}
                        </p>
                    </td>
                </tr>
            {% endfor %}

            <tr>
                <td colspan="2" style="padding: 5px 10px 5px 0"  align="left">
                    {% if order.shippingCostByDistance > 0 %}
                        <p>Delivery charge by distance</p>
                    {% else %}
                        <p>{% trans %}order.shipping_fee{% endtrans %}</p>
                    {% endif %}
                </td>
                <td style="padding: 5px 0" align="left">
                    <p>
                        ฿{{arr_cart_data.summary.shipping_cost|number_format(0, '.', ',') }}

                        {# {% if arr_cart_data.summary.shipping_cost > 0 %}
                            ฿{{arr_cart_data.summary.shipping_cost|number_format(0, '.', ',') }}
                        {% else %}
                            Free Shipping
                        {% endif %} #}
                    </p>
                </td>
            </tr>

            {% if arr_cart_data.summary.discount_amount %}
                <tr>
                    <td colspan="2" style="padding: 5px 10px 5px 0" align="left">
                        <p>{% trans %}order.promotion{% endtrans %} {% if arr_cart_data.summary.discount_code %} Code: {{arr_cart_data.summary.discount_code}}{% endif %}</p>
                    </td>
                    <td style="padding: 5px 0" align="left">
                        <p>-฿{{arr_cart_data.summary.discount_amount|number_format(0, '.', ',') }}</p>
                    </td>
                </tr>
            {% endif %}

            <tr style="border-top: 3px solid rgb(238, 238, 238); border-bottom: 3px solid rgb(238, 238, 238);">
                <td colspan="2" style="border-top: 3px solid rgb(238, 238, 238); border-bottom: 3px solid rgb(238, 238, 238); padding-top: 7px;">
                    <h4>{% trans %}order.total{% endtrans %}</h4>
                </td>
                <td style="border-top: 3px solid rgb(238, 238, 238); border-bottom: 3px solid rgb(238, 238, 238); padding-top: 7px;">
                    <h4>฿{{arr_cart_data.summary.total|number_format(0, '.', ',') }}</h4>
                </td>
            </tr>

            <tr>
                {#
                <td colspan="3" class="esd-block-text es-p15b" align="left">
                    <h4>Delivery Address</h4>
                    {% set shipping_address = arr_cart_data.delivery_information.shipping_address %}
                    {% if shipping_address  %}
                        <p>
                            {{shipping_address.firstName}} {{shipping_address.lastName}}
                            {% if shipping_address.companyName %}{{shipping_address.companyName}}{% endif %}
                            {% if shipping_address.headOffice %}|({{shipping_address.headOffice}}){% endif %}
                        </p>
                        <p>{{shipping_address.address}}, {{shipping_address.district}}, {{shipping_address.amphure}}</p>
                        <p>{{shipping_address.province}},{{shipping_address.countryCode.country}}</p>
                        <p>{{shipping_address.postCode}}<br />{{shipping_address.phone}}</p>
                    {% endif %}
                </td>
                #}
                <td colspan="3">
                    <div class="group">
                        <div class="col-left">
                            <br/>
                            <h4>Shipping Address</h4>
                            {% set shipping_address = arr_cart_data.delivery_information.shipping_address %}
                            {% if shipping_address  %}
                                <p>
                                    {{shipping_address.firstName}} {{shipping_address.lastName}}
                                    {% if shipping_address.companyName %}<br />{{shipping_address.companyName}}{% endif %}
                                    {% if shipping_address.headOffice %}&nbsp;&nbsp;({{shipping_address.headOffice}}){% endif %}<br/><br/>
                                    {{shipping_address.address}}, {{shipping_address.district}}, {{shipping_address.amphure}}<br />
                                    {{shipping_address.province}} {#, {{shipping_address.countryCode.country}}#} {{shipping_address.postCode}}<br />
                                    Phone {{shipping_address.phone}}
                                </p>
                                {% if order.directionDistance %}
                                    <p>
                                        Shipping distance is {{order.directionDistanceText}} from {{order.directionOriginShowroomName}}
                                    </p>
                                {% endif %}
                            {% endif %}
                        </div>
                        <div class="col-right">
                            <h4>Billing Address</h4>
                            {% set billing_address = arr_cart_data.delivery_information.billing_address %}
                            {% if billing_address  %}
                                <p>
                                    {{billing_address.firstName}} {{billing_address.lastName}}
                                    {% if billing_address.companyName %}<br />{{billing_address.companyName}}{% endif %}
                                    {% if billing_address.headOffice %}&nbsp;&nbsp;({{billing_address.headOffice}}){% endif %}<br/><br/>

                                    {{billing_address.address}}, {{billing_address.district}}, {{billing_address.amphure}}<br />
                                    {{billing_address.province}} {#, {{billing_address.countryCode.country}}#} {{billing_address.postCode}}<br />
                                    Phone {{billing_address.phone}}
                                    {% if billing_address.taxPayerId %}
                                        <br/>{% trans %}member.taxpayerid{% endtrans %} {{billing_address.taxPayerId}}
                                    {% endif %}
                                </p>
                            {% endif %}
                        </div>
                    </div>
                </td>
            </tr>
            <tr>
                <td colspan="3">
                    <div class="group">
                        <div class="col-left">
                            <br/>
                            <h4>Payment Method</h4>
                            <div class="panel panel-default">
                                <div class="panel-body" align="center">
                                    {% if order.paymentOption == payment_bank_transfer_code %}
                                        <h5> {{order.paymentOptionTitle|trans}} </h5>
                                        {% if order.paid == 0 %}
                                            <h3 class="text-warning">{{payment_status_awaiting_payment|trans}}</h3>
                                        {% else %}
                                            <h3 class="text-warning">{{payment_status_paid|trans}}</h3>
                                        {% endif %}

                                    {% elseif order.paymentOption == payment_omise_code %}
                                        <!-- CRDT -->
                                        {% set payment_omise = order.customerPaymentOmise %}

                                        <h5> {{order.paymentOptionTitle|trans}} </h5>
                                        {% if payment_omise.status == payment_status_failed  %}
                                            <h3 class="text-warning">{{payment_status_failed|trans}}</h3>
                                        {% else %}
                                            <h3 class="text-warning">{{payment_status_paid|trans}}</h3>
                                        {% endif %}

                                    {% elseif order.paymentOption == payment_cash_on_deliveryr_code %}
                                        <h5> {{order.paymentOptionTitle|trans}} </h5>
                                        {% if order.paid == 0 %}
                                            <h3 class="text-warning">{{payment_status_pending|trans}}</h3>
                                        {% else %}
                                            <h3 class="text-warning">{{payment_status_paid|trans}}</h3>
                                        {% endif %}
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="col-right">
                            {% if order.shipDate %}
                                <br/>
                                <h4>Estimated Delivery Date</h4>
                                <div class="panel panel-default">
                                    <div class="panel-body" align="center">
                                        <h5>&nbsp;</h5>
                                        <h3 class="text-warning">{{order.shipDate|date("d")}} {{ order.shipDate|date("F")|trans }} {{ order.shipDate|date("Y") }}</h3>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </td>
            </tr>

            {% if (order.paymentOption == payment_bank_transfer_code) %}
                {% if (order.paid != 1) %}
                    <tr>
                        <td colspan="3" class="esd-block-text es-p15b" align="left">
                            <h4>How to pay (Bank Transfer)</h4>
                            <p>- Online bank transfers. Log in to your online account and select the option for making a payment</p>
                            <p>- In-branch bank transfers. If you have the money in cash, you can pay it into the account of the person you owe it to in-branch.</p>
                            <table class="table table-striped">
                                <th>#</th>
                                <th colspan="2">Bank name</th>
                                <th>Account Number</th>
                                <th>Account name</th>
                                <th>Branch</th>
                                {% for bank in bankAccount %}
                                    <tr>
                                        <td width = "10">{{ loop.index }}.</td>
                                        <td width = "50">
                                            {% if bank.image %}
                                                <img src="{{bank.image|imagine_filter('img_small_thumb')}}" alt="">
                                            {% endif %}
                                        </td>
                                        <td>{{ bank.title }}</td>
                                        <td>{{ bank.accountNumber }}</td>
                                        <td>{{ bank.accountName }}</td>
                                        <td>{{ bank.branch }}</td>
                                    </tr>
                                {% endfor %}
                            </table>
                            <br/>
                            <div class="col-md-12 text-center">
                                <a href="{{url('confirm_payment',{'orderId': order.orderNumber})}}">
                                    <button class="btn btn-default">{% trans %}menu.confirm.payment{% endtrans %}</button>
                                </a>
                            </div>
                            <br/>
                        </td>
                    </tr>
                {% endif %}

            {% elseif order.paymentOption == payment_omise_code %}
                {% if payment_omise.tokenId %}
                    <tr>
                        <td colspan="3" class="esd-block-text es-p15b" align="left">
                            <h4>Payment Information</h4>
                            <table class="table table-striped">
                                <th></th>
                                <th></th>
                                <tr>
                                    <td width="150">Card Name :</td>
                                    <td>{{payment_omise.cardName}}</td>
                                </tr>
                                <tr>
                                    <td width="150">Card Number :</td>
                                    <td>**** **** **** {{payment_omise.cardLastDigits}}</td>
                                </tr>
                                <tr>
                                    <td>Card Issuer :</td>
                                    <td>{{payment_omise.cardBank}}</td>
                                </tr>
                                <tr>
                                    <td>Brand :</td>
                                    <td>{{payment_omise.cardBrand}}</td>
                                </tr>
                                {#
                                <tr>
                                    <td>Amount :</td>
                                    <td>
                                        {% if payment_omise.amount %}
                                    {% if payment_omise.currency|upper == 'THB' %}฿{% else %}{{payment_omise.currency}} {% endif %}{{payment_omise.amount|number_format(0, '.', ',')}}
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <td>Decision :</td>
                                    <td>{{payment_omise.status|capitalize}}</td>
                                </tr>
                                {% if payment_omise.status == 'failed' %}
                                    <tr>
                                        <td colspan="2">
                                            {{payment_omise.failureMessage|capitalize}}
                                        </td>
                                    </tr>
                                {% endif %}
                                #}
                            </table>
                            <p>&nbsp;</p>
                        </td>
                    </tr>
                {% endif %}
            {% endif %}
        </tbody>
    </table>
{% endblock %}
